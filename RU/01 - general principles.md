# Общие принципы

- Читабельность - очень важное свойство кода. Читабельность экономит время и улучшает взаимопонимание. Ряд принципов ниже прямо или косвенно улучшают читабельность. Идеал читабельного кода - это когда документация к нему не нужна, достаточно пройтись глазами по коду и понять что он делает (идеал объективно сложно-достижимый, но нужно к нему стремиться). Это подразумевает понятно название переменных, понятное название методов, правильное структурирование кода, чтобы каждый фрагмент занимался своим понятным делом, разбиение кода на небольшие блоки, которые умещаются в голову за раз (классы, методы ...) и т.п.
- Индентация. Соблюдение индентации в коде обязательно. Неправильная индентация очень сильно ухудшает читабельность. Также см. Kevlin Henney - Seven Ineffective Coding Habits of Many Programmers
- Использование исключений. Исключения позволяют унифицировать обработку ошибок. Catch можно расположить на самом верхнем уровне выполнения программы - исключения будут “выныривать” с любой глубины и, например, выводится пользователю. Можно создавать разные классы исключений для разных категорий ошибок (если это не создает сложности в их обработке - пользуйтесь наследованием).
- Отделение выборки данных, обработки и отображения (общий принцип подхода model-view-controller). Обработка данных не должна знать про отображение и наоборот
    - Для обработки данных нужно писать тесты (см ниже). Если в коде есть select, то написать тест толком нельзя. Поэтому выборка данных должна быть в отдельном методе или интерфейсе (чтобы его можно было подменить). 
    - Отображение данных может быть разное. Например можно вывести данные в ALV или отправить по почте в виде PDF файла. А данные одинаковые, только представление разное. Также представление часто означает какое-то взаимодействие с пользователем. 
    - Поэтому обработка данных не должна знать про отображение, а отображение - про обработку. Каждый кусок кода должен заниматься только своей функцией, тогда его легко читать, тестировать и отлаживать.
- Стремитесь использовать Функциональное программирование - если очень кратко функциональный подход состоит в том, чтобы писать функции/методы без состояния и side-effects. Т.е. Такой код, который явно преобразовывает входящие данные в исходящие, без обращений к внешним сущностям. Такие функции легко отлаживаются, легко тестируются, менее подвержены багам. Вызывающий их код легче читается (т.к. Не нужно думать про побочные эффекты). На практике старайтесь где возможно пользоваться статическими методами, без внешних переменных. Старайтесь избегать низкоуровневых методов, которые меняют атрибуты класса - выносите изменения в верхнеуровневые “контроллеро-подобные” методы.
- Какие данные и как будут ходить между объектами/вызовами и какая сущность каждого класса - именно с этого начинайте продумывать архитектуру. Обычно данные более однозначны, чем внутреннее устройство классов. Правильно продумав обмен данными можно будет легче рефакторить код классов и избежать переписывания юнит тестов, при изменении архитектуры кода. Правильно разделив сущности код делается более универсальным и переиспользуемым.
- Пишите юнит тесты (подробнее ниже). Это не “желательно”, это обязательно.
- Уважайте подходы оформления, принятые на конкретном проекте. Старайтесь придерживаться единого стиля. Это улучшает читабельность, а следовательно экономит ваше время и время ваших коллег при восприятии информации.
- Используйте осмысленные названия методов и переменных. Код должен очевидным настолько насколько это возможно, причем без комментариев. Для этого используйте осмысленные названия методов и переменных. Длинные названия - это в целом нормально, если они точно объясняют происходящее. Код должен читаться, на английском. Стоит потратить немного времени, чтобы выбрать правильно подходящее слово на английском для названия переменной или метода. Исключением могут быть итераторы, которые используются в пределах нескольких следующих строк и контекст которых очевиден (`<i>`, `<line>`). Есть выражение “в программировании две самые большие проблемы: инвалидация кеша и наименование переменных”. Хорошее название придумать сложно - это нормально - не сдавайтесь.
- Комментарии в коде: должны быть, если из кода не очевидно, почему он написан именно так. (обычно это касается бизнес логики)
- Пишите документацию к вашему коду. Критерий качества документации в первую очередь, чтобы вы сами могли вернуться к коду через 3 месяца и быстро восстановить знания о том, что и как работает. 
- Для отслеживания изменений в коде мы используем Git и abapGit
    - Что такое GIT, GITHUB и BITBUCKET? / Просто и понятно
    - Git Fu - правила хорошего использования Git
    - Using git and github on an sap abap system
- Избегайте неопределенных состояний программы. Код должен защищать сам себя от кривого ввода, в том числе от неправильного использования другим кодом. Используйте проверки и assert’ы в начале методов - не доверяйте вызывающему коду, даже если написали его сами - через месяц вы забудете об ограничениях и сделаете ошибку, проверки в начале должны ее словить. Гораздо лучше свалившаяся в дамп программа, чем программа, продолжившая выполнение с незапланированным состоянием. Избегайте этого всеми силами.
    - Еще лучше чем дамп, будет корректный вывод ошибки пользователю. Однако стоит различать пользовательские ошибки (появившиеся в результате кривых данных, введенных пользователем) и программистские (появившиеся в результате неправильного использования метода, напр. ожидается что параметр не пустой). Первые должны быть подробные, давать информацию о том, что именно произошло и что делать (см юзабилити ниже). Вторые могут быть проще.
- Глобальные переменные - это зло, не используйте их. Совсем. Никогда.
- Старайтесь, чтобы функции/методы были не длиннее 60-80 строк. Это делает их более читаемыми, структурированными и сфокусированными на одной задаче. А также это легче тестировать, отлаживать. (NASA style, < 60 lines of code is a good example) 
- Не используйте более 3 уровней вложенности ветвлений - такой код всегда можно оптимизировать или разделить. В целом, думайте как уменьшить количество ветвлений - они плохо читаются. Полезно себе задать себе вопрос, как можно написать этот код совсем без ветвлений! На пути к такой цели, могут обнаружиться интересные архитектурные открытия. Либо понимание что данный конкретный if должен быть в другом месте, на более высоком уровне, где “принимается решение” о направлении работы программы.
- Не зашивайте бизнес константы в код (no hardcode). 
    - Я серьезно, не зашивайте бизнес константы в код!!! Параметры к программе, таблица настройки, динамическое определение из стандартных настроек системы (лучше всего), но не хардкодьте бизнес значения, не стандартные для системы глобально. А еще, Боже упаси, хардкодить АПИ ключи или пароли к чему то.
- Толковое из онлайн видео (сильно!)
    - Code must be written for people to read and only incidentally for machines to execute

Статья [Как важно писать хороший код](https://m.habr.com/ru/post/206294/) - четко ! (Must read)

- если неудобно, то скорее всего плохо и нужно переписать - это сигнал/эвристика, что что-то сделано не так.
